<Window x:Class="ModManager.Windows.PakFileExplorerWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:ModManager.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:icons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mv="using:ModManager.Models.View"
    xmlns:suki="clr-namespace:SukiUI.Controls;assembly=SukiUI"
    xmlns:vm="using:ModManager.ViewModels.Window"
    Title="{Binding Title}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:DataType="vm:PakFileExplorerWindowViewModel"
    Background="Black"
    Focusable="True"
    Icon="avares://ModManager/Assets/BG3ModManager.ico"
    Topmost="False"
    mc:Ignorable="d">
	<Design.DataContext>
		<vm:DesignPakFileExplorerWindowViewModel />
	</Design.DataContext>
	<Window.Resources>
		<MenuFlyout x:Key="FileContextMenu" x:DataType="mv:PakFileEntry">
			<MenuItem Name="CopyToButton"
			    CommandParameter="{Binding}"
			    Header="Extract To..."
			    Icon="{icons:MaterialIconExt Kind=Download}" />

			<MenuItem Name="CopyPathButton"
			    CommandParameter="{Binding FilePath}"
			    Header="Copy Path to Clipboard..."
			    Icon="{icons:MaterialIconExt Kind=ClipboardAdd}" />
		</MenuFlyout>
	</Window.Resources>
	<Panel>
		<Grid Margin="4" Grid.IsSharedSizeScope="True">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>
			<Grid Margin="4">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				<controls:EnhancedTextBox Text="{Binding PakFilePath, Mode=TwoWay}" />
				<Button Grid.Column="1"
				    Height="32"
				    Command="{Binding OpenFileBrowserCommand}"
				    Content="..." />
			</Grid>
			<TreeDataGrid Name="FilesTreeView"
			    Grid.Row="1"
			    AutoDragDropRows="False"
			    Background="Transparent"
			    DragDrop.AllowDrop="False"
			    Focusable="True"
			    Source="{Binding FileTreeSource}">
				<TreeDataGrid.Resources>
					<DataTemplate x:Key="FileNameWithIconCell" x:DataType="mv:PakFileEntry">
						<Grid ContextFlyout="{StaticResource FileContextMenu}">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="auto" SharedSizeGroup="Icons" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>
							<icons:MaterialIcon Grid.Column="0" VerticalAlignment="Center" Kind="{Binding Icon}" />
							<TextBlock Grid.Column="1"
							    Margin="4,0,0,0"
							    VerticalAlignment="Center"
							    Text="{Binding FileName}"
							    TextAlignment="Left"
							    ToolTip.Tip="{Binding FilePath}" />
						</Grid>
					</DataTemplate>
				</TreeDataGrid.Resources>
			</TreeDataGrid>
			<!--<TreeView Name="FilesTreeView"
			    Grid.Row="1"
			    Background="Transparent"
			    Focusable="True"
			    Grid.IsSharedSizeScope="True"
			    ItemsSource="{Binding Entries}"
			    SelectedItem="{Binding SelectedItem}"
			    SelectedItems="{Binding SelectedItems}"
			    SelectionMode="Multiple">
				<TreeView.Styles>
					<Style x:DataType="mv:PakFileEntry" Selector="TreeViewItem">
						<Setter Property="IsSelected" Value="{Binding IsSelected}" />
						<Setter Property="IsExpanded" Value="{Binding IsExpanded}" />
						<Setter Property="ContextFlyout" Value="{StaticResource FileContextMenu}" />
					</Style>
				</TreeView.Styles>
				<TreeView.DataTemplates>
					<TreeDataTemplate DataType="mv:PakFileEntry" ItemsSource="{Binding Subfiles}">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="auto" SharedSizeGroup="Icons" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>
							<icons:MaterialIcon Grid.Column="0" Kind="{Binding Icon}" />
							<TextBlock Grid.Column="1"
							    Margin="4,0,0,0"
							    Text="{Binding FileName}"
							    ToolTip.Tip="{Binding FilePath}" />
						</Grid>
					</TreeDataTemplate>
				</TreeView.DataTemplates>
			</TreeView>-->
		</Grid>
	</Panel>
</Window>
