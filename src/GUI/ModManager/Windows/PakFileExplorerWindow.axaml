<Window x:Class="ModManager.Windows.PakFileExplorerWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:ModManager.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:icons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
    xmlns:local="using:ModManager.Windows"
    xmlns:manager="using:ModManager"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mv="using:ModManager.Models.View"
    xmlns:suki="clr-namespace:SukiUI.Controls;assembly=SukiUI"
    xmlns:vm="using:ModManager.ViewModels.Window"
    Title="{Binding Title}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:DataType="vm:PakFileExplorerWindowViewModel"
    Background="Black"
    Focusable="True"
    Icon="avares://ModManager/Assets/BG3ModManager.ico"
    Topmost="False"
    mc:Ignorable="d">
	<Design.DataContext>
		<vm:DesignPakFileExplorerWindowViewModel />
	</Design.DataContext>
	<Window.Resources>
		<MenuFlyout x:Key="FileContextMenu" x:DataType="mv:ModFileEntry">
			<MenuItem Command="{Binding $parent[local:PakFileExplorerWindow].ViewModel.ExtractFileCommand}"
			    CommandParameter="{Binding}"
			    Header="Extract To..."
			    Icon="{icons:MaterialIconExt Kind=Download}" />
			<Separator />
			<MenuItem Command="{Binding $parent[local:PakFileExplorerWindow].ViewModel.ExtractSelectedFilesCommand}" Header="Extract All Selected To..." Icon="{icons:MaterialIconExt Kind=Download}" />
			<Separator />
			<MenuItem Command="{Binding Path=CopyToClipboardCommand, Source={x:Static manager:AppServices.Commands}}"
			    CommandParameter="{Binding FilePath}"
			    Header="Copy Path to Clipboard..."
			    Icon="{icons:MaterialIconExt Kind=ClipboardAdd}" />
		</MenuFlyout>
	</Window.Resources>
	<Window.Styles />
	<Panel>
		<Grid Margin="4" Grid.IsSharedSizeScope="True" RowDefinitions="Auto,*">
			<StackPanel Margin="4" Orientation="Horizontal">
				<Button Classes="icon flat"
				    Command="{Binding AddModCommand}"
				    Content="{icons:MaterialIconExt Kind=FileImport, Classes='SpringGreen'}"
				    ToolTip.Tip="Add Mod(s)..." />
				<Button Classes="icon flat"
				    Command="{Binding OpenFileBrowserCommand}"
				    Content="{icons:MaterialIconExt Kind=FolderOpen, Classes='Tan'}"
				    ToolTip.Tip="Add Pak..." />
				<Rectangle Width="1" Margin="2,0" Fill="{DynamicResource SukiBorderBrush}" />
				<Button Classes="icon flat"
				    Command="{Binding ClearCommand}"
				    Content="{icons:MaterialIconExt Kind=CloseBoxMultiple, Classes='Red'}"
				    ToolTip.Tip="Clear All" />
			</StackPanel>
			<TreeDataGrid Name="FilesTreeView"
			    Grid.Row="1"
			    AutoDragDropRows="False"
			    Background="Transparent"
			    DragDrop.AllowDrop="False"
			    Focusable="True"
			    Source="{Binding FileTreeSource}">
				<TreeDataGrid.Resources>
					<DataTemplate x:Key="FileNameWithIconCell" x:DataType="mv:ModFileEntry">
						<Grid ContextFlyout="{StaticResource FileContextMenu}">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="auto" SharedSizeGroup="Icons" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>
							<icons:MaterialIcon Grid.Column="0"
							    VerticalAlignment="Center"
							    Foreground="{Binding IconColor}"
							    Kind="{Binding Icon}" />
							<TextBlock Grid.Column="1"
							    Margin="4,0,0,0"
							    VerticalAlignment="Center"
							    Text="{Binding FileName}"
							    TextAlignment="Left"
							    ToolTip.Tip="{Binding FilePath}" />
						</Grid>
					</DataTemplate>
				</TreeDataGrid.Resources>
			</TreeDataGrid>
			<!--<TreeView Name="FilesTreeView"
			    Grid.Row="1"
			    Background="Transparent"
			    Focusable="True"
			    Grid.IsSharedSizeScope="True"
			    ItemsSource="{Binding Entries}"
			    SelectedItem="{Binding SelectedItem}"
			    SelectedItems="{Binding SelectedItems}"
			    SelectionMode="Multiple">
				<TreeView.Styles>
					<Style x:DataType="mv:PakFileEntry" Selector="TreeViewItem">
						<Setter Property="IsSelected" Value="{Binding IsSelected}" />
						<Setter Property="IsExpanded" Value="{Binding IsExpanded}" />
						<Setter Property="ContextFlyout" Value="{StaticResource FileContextMenu}" />
					</Style>
				</TreeView.Styles>
				<TreeView.DataTemplates>
					<TreeDataTemplate DataType="mv:PakFileEntry" ItemsSource="{Binding Subfiles}">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="auto" SharedSizeGroup="Icons" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>
							<icons:MaterialIcon Grid.Column="0" Kind="{Binding Icon}" />
							<TextBlock Grid.Column="1"
							    Margin="4,0,0,0"
							    Text="{Binding FileName}"
							    ToolTip.Tip="{Binding FilePath}" />
						</Grid>
					</TreeDataTemplate>
				</TreeView.DataTemplates>
			</TreeView>-->
		</Grid>
	</Panel>
</Window>
